# ğŸŒŠ Wave çº¯äºŒè¿›åˆ¶ç¼–è¯‘å™¨
# åªä½¿ç”¨ emitï¼Œæ—  outï¼ˆé¿å…ä»£ç æ··ä¹±ï¼‰
# åŠŸèƒ½: è¯»å– stdinï¼Œè§£æ out/emitï¼Œè¾“å‡ºåˆ° stdout

# Tile: brk åˆ†é…å†…å­˜
emit "\x48\xc7\xc0\x0c\x00\x00\x00"
emit "\x48\x31\xff"
emit "\x0f\x05"
emit "\x49\x89\xc4"
emit "\x48\x89\xc7"
emit "\x48\x81\xc7\x00\x00\x02\x00"
emit "\x48\xc7\xc0\x0c\x00\x00\x00"
emit "\x0f\x05"
emit "\x4c\x89\xe3"
emit "\x48\x81\xc3\x00\x00\x01\x00"

# read(0, r12, 0x10000)
emit "\x48\x31\xc0"
emit "\x48\x31\xff"
emit "\x4c\x89\xe6"
emit "\x48\xc7\xc2\x00\x00\x01\x00"
emit "\x0f\x05"
emit "\x49\x89\xc5"
emit "\x4d\x31\xf6"
emit "\x4d\x31\xff"

# main_loop: cmp r14, r13; jge exit
emit "\x4d\x39\xee"
emit "\x0f\x8d\xf8\x00\x00\x00"

# mov al, [r12+r14]
emit "\x43\x8a\x04\x34"

# ç©ºç™½: ' ' '\n' '\t' '\r'
emit "\x3c\x20"
emit "\x0f\x84\xc8\x00\x00\x00"
emit "\x3c\x0a"
emit "\x0f\x84\xc0\x00\x00\x00"
emit "\x3c\x09"
emit "\x0f\x84\xb8\x00\x00\x00"
emit "\x3c\x0d"
emit "\x0f\x84\xb0\x00\x00\x00"

# æ³¨é‡Š '#'
emit "\x3c\x23"
emit "\x0f\x84\x90\x00\x00\x00"

# æ£€æŸ¥ 'o' (out)
emit "\x3c\x6f"
emit "\x0f\x85\x38\x00\x00\x00"
emit "\x43\x80\x7c\x34\x01\x75"
emit "\x0f\x85\x2c\x00\x00\x00"
emit "\x43\x80\x7c\x34\x02\x74"
emit "\x0f\x85\x20\x00\x00\x00"
emit "\x43\x80\x7c\x34\x03\x20"
emit "\x0f\x85\x14\x00\x00\x00"
emit "\x49\x83\xc6\x04"
emit "\xeb\x2a"

# æ£€æŸ¥ 'e' (emit)
emit "\x3c\x65"
emit "\x0f\x85\x5c\x00\x00\x00"
emit "\x43\x80\x7c\x34\x01\x6d"
emit "\x0f\x85\x50\x00\x00\x00"
emit "\x43\x80\x7c\x34\x02\x69"
emit "\x0f\x85\x44\x00\x00\x00"
emit "\x43\x80\x7c\x34\x03\x74"
emit "\x0f\x85\x38\x00\x00\x00"
emit "\x43\x80\x7c\x34\x04\x20"
emit "\x0f\x85\x2c\x00\x00\x00"
emit "\x49\x83\xc6\x05"

# find_quote
emit "\x43\x8a\x04\x34"
emit "\x3c\x22"
emit "\x74\x05"
emit "\x49\xff\xc6"
emit "\xeb\xf5"

# skip quote
emit "\x49\xff\xc6"

# copy_loop
emit "\x43\x8a\x04\x34"
emit "\x3c\x22"
emit "\x74\x36"
emit "\x3c\x5c"
emit "\x75\x26"
emit "\x49\xff\xc6"
emit "\x43\x8a\x04\x34"
emit "\x3c\x78"
emit "\x75\x1c"
emit "\x49\xff\xc6"
emit "\x43\x8a\x04\x34"
emit "\x3c\x60"
emit "\x7e\x04"
emit "\x2c\x57"
emit "\xeb\x02"
emit "\x2c\x30"
emit "\xc0\xe0\x04"
emit "\x88\xc1"
emit "\x49\xff\xc6"
emit "\x43\x8a\x04\x34"
emit "\x3c\x60"
emit "\x7e\x04"
emit "\x2c\x57"
emit "\xeb\x02"
emit "\x2c\x30"
emit "\x08\xc1"
emit "\x88\xc8"

# output byte
emit "\x42\x88\x04\x3b"
emit "\x49\xff\xc7"
emit "\x49\xff\xc6"
emit "\xeb\xc2"

# end_string
emit "\x49\xff\xc6"
emit "\xe9\x28\xff\xff\xff"

# skip_comment
emit "\x49\xff\xc6"
emit "\x43\x8a\x04\x34"
emit "\x3c\x0a"
emit "\x75\xf5"
emit "\xe9\x18\xff\xff\xff"

# skip_ws
emit "\x49\xff\xc6"
emit "\xe9\x10\xff\xff\xff"

# skip_line
emit "\x43\x8a\x04\x34"
emit "\x3c\x0a"
emit "\x74\x05"
emit "\x49\xff\xc6"
emit "\xeb\xf3"
emit "\x49\xff\xc6"
emit "\xe9\xfa\xfe\xff\xff"

# exit: write(1, rbx, r15) then exit(0)
emit "\x48\xc7\xc0\x01\x00\x00\x00"
emit "\x48\xc7\xc7\x01\x00\x00\x00"
emit "\x48\x89\xde"
emit "\x4c\x89\xfa"
emit "\x0f\x05"
emit "\x48\xc7\xc0\x3c\x00\x00\x00"
emit "\x48\x31\xff"
emit "\x0f\x05"
