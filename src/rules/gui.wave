# ğŸŒŠ Wave GUI ç³»ç»Ÿ
# çª—å£å’Œç»„ä»¶ï¼šè§„åˆ™é©±åŠ¨çš„ç•Œé¢ç®¡ç†

use rules/graphics
use rules/style
use rules/fate

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# çª—å£å®šä¹‰ (boundary è§„å¾‹ï¼šç•Œé¢è¾¹ç•Œ)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

window {
    title: ""
    x: 0
    y: 0
    width: 800
    height: 600
    visible: false
    mode: 0         # 0=windowed, 1=fullscreen, 2=borderless
}

# çª—å£åˆ—è¡¨
windows: []

fn window.create title width height {
    w = {
        title: title
        x: 0
        y: 0
        width: width
        height: height
        visible: true
        mode: 0
    }
    windows <- w
    
    # æ›´æ–°å¸§ç¼“å†²åŒº
    framebuffer.width = width
    framebuffer.height = height
    framebuffer.stride = width * 4
    
    -> w
}

fn window.close w {
    w.visible = false
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç»„ä»¶å®šä¹‰ (è¿æ¥è§„å¾‹ï¼šç»„ä»¶å…³ç³»)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

component_type {
    button: 1
    input: 2
    list: 3
    panel: 4
    card: 5
}

component {
    id: ""
    type: 0
    x: 0
    y: 0
    width: 0
    height: 0
    text: ""
    value: ""
    enabled: true
    visible: true
    style: ""
}

# ç»„ä»¶åˆ—è¡¨
components: []

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç»„ä»¶åˆ›å»º (è®°å¿†è§„å¾‹ï¼šæ³¨å†Œç»„ä»¶)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

fn component.button id x y w h text {
    c = {
        id: id
        type: component_type.button
        x: x
        y: y
        width: w
        height: h
        text: text
        enabled: true
        visible: true
    }
    components <- c
    -> c
}

fn component.input id x y w h {
    c = {
        id: id
        type: component_type.input
        x: x
        y: y
        width: w
        height: h
        text: ""
        value: ""
        enabled: true
        visible: true
    }
    components <- c
    -> c
}

fn component.list id x y w h {
    c = {
        id: id
        type: component_type.list
        x: x
        y: y
        width: w
        height: h
        items: []
        enabled: true
        visible: true
    }
    components <- c
    -> c
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ç»„ä»¶æ¸²æŸ“ (æ¼”åŒ–è§„å¾‹ï¼šç»„ä»¶åˆ°åƒç´ )
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

fn component.render c {
    when c.visible {
        when c.type == component_type.button {
            # æŒ‰é’®èƒŒæ™¯
            shape.add_rect(c.x, c.y, c.width, c.height, 0x3498DB)
            # æŒ‰é’®æ–‡å­—
            text_x = c.x + c.width / 2
            text_y = c.y + c.height / 2
            shape.add_text(text_x, text_y, c.text, 0xFFFFFF)
        }
        
        when c.type == component_type.input {
            # è¾“å…¥æ¡†èƒŒæ™¯
            shape.add_rect(c.x, c.y, c.width, c.height, 0xFFFFFF)
            # è¾¹æ¡†
            shape.add_line(c.x, c.y, c.x + c.width, c.y, 0xBDC3C7)
            shape.add_line(c.x, c.y + c.height, c.x + c.width, c.y + c.height, 0xBDC3C7)
            shape.add_line(c.x, c.y, c.x, c.y + c.height, 0xBDC3C7)
            shape.add_line(c.x + c.width, c.y, c.x + c.width, c.y + c.height, 0xBDC3C7)
            # æ–‡å­—
            shape.add_text(c.x + 5, c.y + c.height / 2, c.value, 0x2C3E50)
        }
    }
}

fn gui.render_all {
    components -> each c {
        component.render(c)
    }
    render()
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# GUI æ¨¡å¼ (ç»Ÿä¸€è§„å¾‹ï¼šæ¨¡å¼é€‰æ‹©)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

gui_mode {
    stem: 1     # DisplayStem
    tile: 2     # DisplayTile
}

current_gui_mode: gui_mode.tile

fn gui.set_mode mode {
    current_gui_mode = mode
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# GUI è¯­æ³•æ”¯æŒ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

intent gui {
    action: gui.set_mode
}

intent window {
    action: window.create
}

intent component.button {
    action: component.button
}

intent component.input {
    action: component.input
}

intent component.list {
    action: component.list
}
