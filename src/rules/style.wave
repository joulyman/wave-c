# ğŸŒŠ Wave æ ·å¼ç³»ç»Ÿ
# CSS-like æ ·å¼ï¼šè§„åˆ™é©±åŠ¨çš„å±æ€§ç®¡ç†

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æ ·å¼å®šä¹‰ (è®°å¿†è§„å¾‹ï¼šæŒä¹…å±æ€§)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

style_def {
    name: ""
    fill: 0xFFFFFF
    stroke: 0x000000
    stroke_width: 1
    opacity: 100
    radius: 0
    font_size: 16
    padding: 0
    margin: 0
    align: 0          # 0=left, 1=center, 2=right
    display: 0        # 0=block, 1=inline, 2=flex, 3=grid
}

# æ ·å¼æ³¨å†Œè¡¨
styles: []

# å½“å‰æ ·å¼
current_style: {
    fill: 0xFFFFFF
    stroke: 0x000000
    stroke_width: 1
    opacity: 100
    radius: 0
    font_size: 16
    padding: 0
    margin: 0
    align: 0
    display: 0
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# æ ·å¼æ“ä½œ (è¿æ¥è§„å¾‹ï¼šæ ·å¼ä¸å…ƒç´ è¿æ¥)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

fn style.define name properties {
    new_style = {
        name: name
        fill: properties.fill
        stroke: properties.stroke
        stroke_width: properties.stroke_width
        opacity: properties.opacity
        radius: properties.radius
        font_size: properties.font_size
        padding: properties.padding
        margin: properties.margin
        align: properties.align
        display: properties.display
    }
    styles <- new_style
}

fn style.find name {
    styles -> each s {
        when s.name == name {
            -> s
        }
    }
    -> null
}

fn style.apply name {
    s = style.find(name)
    when s != null {
        current_style = s
    }
}

fn style.reset {
    current_style = {
        fill: 0xFFFFFF
        stroke: 0x000000
        stroke_width: 1
        opacity: 100
        radius: 0
        font_size: 16
        padding: 0
        margin: 0
        align: 0
        display: 0
    }
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# å¸¦æ ·å¼çš„ç»˜å›¾ (ç»„åˆè§„å¾‹ï¼šæ ·å¼ + å½¢çŠ¶)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

fn styled.box x y w h {
    # åº”ç”¨å½“å‰æ ·å¼ç»˜åˆ¶çŸ©å½¢
    shape.add_rect(x, y, w, h, current_style.fill)
    
    # å¦‚æœæœ‰è¾¹æ¡†
    when current_style.stroke_width > 0 {
        # ä¸Šè¾¹
        shape.add_line(x, y, x + w, y, current_style.stroke)
        # ä¸‹è¾¹
        shape.add_line(x, y + h, x + w, y + h, current_style.stroke)
        # å·¦è¾¹
        shape.add_line(x, y, x, y + h, current_style.stroke)
        # å³è¾¹
        shape.add_line(x + w, y, x + w, y + h, current_style.stroke)
    }
}

fn styled.text x y content {
    # åº”ç”¨å½“å‰æ ·å¼ç»˜åˆ¶æ–‡æœ¬
    shape.add_text(x, y, content, current_style.fill)
}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# style è¯­æ³•æ”¯æŒ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

intent style {
    action: style.define
}

intent apply {
    action: style.apply
}

intent box {
    action: styled.box
}

intent text {
    action: styled.text
}
